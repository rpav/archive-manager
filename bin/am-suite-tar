#!/bin/bash

usage() {
    echo
    echo "am-suite-tar [OPTIONS...] <cmd> <archive>"
    echo
    echo "    l, list                list files in archive"
    echo
    echo "Options:"
    echo "    --comp TOOL            Compression tool for pre/post process"
    echo "    -h, --help             This help"
    echo
}

while [ "$1" ]; do
    opt="$1"
    case "$opt" in
        --comp) shift; comp="$1" ;;
        -h|--help) usage ; exit ;;
        *) break ;;
    esac
    shift
done

cmd="$1"
archive="$2"
shift 2

if [ "$comp" ]; then
    comp_args="cat"
else
    comp=cat
fi

case "$cmd" in
    l|list) ($comp $comp_args $archive) | tar tvf - |
              while read -ra line; do
                  echo "${line[5]}"
              done
          ;;
    x) ($comp $comp_args $archive) | tar xvf - ;;
esac
